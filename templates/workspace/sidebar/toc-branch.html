<div data-media-type="{{mediaType}}" class="editor-node-body editor-drop-zone editor-drop-zone-in">
{{! Renders a single node in the book editor tree}}
{{! Includes drop zones and supports nodes that point to content (with ids) and containers (chapter/unit)}}
{{! The div above MUST be here and MUST NOT have any spaces before it because the 'li' parent will render differently}}

<i class="drag-handle" {{#unless ancestorSelected}}title="{{#if isPicker}}Drag this content into the open book's Table of Contents to use it there also.{{else}}Drag to a different part of the book.{{/if}}"{{/unless}}></i>

{{#if isGroup}}
  <span class="editor-expand-collapse toggle-expand" title="Click to expand/collapse"><i class="icon-content"></i></span>
{{/if}}

<div class="pull-right dropdown module-controls">
  {{#unless selected}} 
    <a href="#" class="pull-right edit-settings-edit" title="Go edit this {{prettyName}}">
      <i class="icon-circle-arrow-right"></i>
    </a>
  {{/unless}}
  <a href="#" class="pull-right edit-settings dropdown-toggle" data-toggle="dropdown" title="Options for this {{prettyName}}">
    <i class="icon-chevron-sign-down"></i>
  </a>
  <ul class="dropdown-menu">
    <li>
      <a class="edit-settings-rename">
        <i class="icon-pencil"></i>
        Rename this {{prettyName}}
      </a>
    </li>
    {{#if canEditMetadata }}
    <li>
      <a class="edit-settings-metadata">
        <i class="icon-pencil"></i>
        Edit authors, license, etc.
      </a>
    </li>
    {{/if}}
    {{#if canRemove}}
      <li>
        <a class="delete-module">
          <i class="icon-remove"></i>
          Delete this {{prettyName}}
        </a>
      </li>
    {{/if}}
  </ul>
</div>
{{#if editAction}}
  <span data-media-type="{{#if content}}{{content.mediaType}}{{else}}{{mediaType}}{{/if}}" data-content-id="{{id}}" data-content-title="{{content.title}}" class="edit-action"><i class="icon-content"></i>
    {{! A book title (if set) overrides the module title}}
    {{#if title}}
      <span class="editor-node-title">{{title}}</span>
    {{else}}
      {{#if content}}
        <span class="editor-node-title autogenerated-text">{{content.title}}</span>
      {{else}}
        <span class="editor-node-title autogenerated-text">BUG:NO_TITLE_SET</span>
      {{/if}}
    {{/if}}


    {{#if _isDirty}}
      <small class="toc-badge">
        <span class="is-dirty" title="This has unsaved changes">
          <i class="icon-asterisk"></i>
        </span>
      </small>
    {{/if}}
    {{#if _hasRemoteChanges}}
      <small class="toc-badge">
        <span class="has-remote-changes" title="This has been changed by someone else">
          <i class="icon-refresh"></i>
        </span>
      </small>
    {{/if}}


  </span>
{{else}}
  <span class="{{#if isGroup}}toggle-expand{{else}}go-edit{{/if}}" data-media-type="{{mediaType}}" data-content-title="{{title}}" class="no-edit-action editor-drop-zone editor-drop-zone-in" {{#if title}}title="{{title}}"{{/if}}>
    <i class="icon-content"></i>
    <span class="editor-node-title">
      <span {{#unless isGroup}}{{#if ancestorSelected}}class="btn-link"{{else}}{{#unless selected}}class="btn-link"{{/unless}}{{/if}}{{/unless}}>
        <!-- If the content does not have a title (like an image) or it has not been looked up yet use the path -->
        {{#if title}}
          {{{title}}}
        {{else}}
          {{id}}
        {{/if}}
      </span>
    </span>
    
    {{#if _isDirty}}
      <small class="toc-badge">
        <span class="is-dirty" title="This has unsaved changes">
          <i class="icon-asterisk"></i>
        </span>
      </small>
    {{/if}}
    {{#if _hasRemoteChanges}}
      <small class="toc-badge">
        <span class="has-remote-changes" title="This has been changed by someone else">
          <i class="icon-refresh"></i>
        </span>
      </small>
    {{/if}}
    
  </span>
{{/if}}

</div>

{{#if hasParent}}
  {{#if hasChildren}}
  {{else}}
    <div class="editor-drop-zone editor-drop-zone-after editor-node-after"></div>
  {{/if}}
{{else}}
  <div class="editor-node-after"></div>
{{/if}}

{{! Always include the list because a node _may_ get children later}}
<ol></ol>

{{#if hasParent}}
  {{#if hasChildren}}
    <div class="editor-drop-zone editor-drop-zone-after editor-node-after"></div>
  {{/if}}
{{/if}}
